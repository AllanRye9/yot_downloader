# yot_downloader
A simple, fast, and self-hosted web application for downloading videos from YouTube and hundreds of other sites. It provides a clean browser UI with real-time progress bars, audio notifications, and an instant file library to stream or save your videos.

---

## Features

- **One-click downloads** – paste any URL supported by [yt-dlp](https://github.com/yt-dlp/yt-dlp) and hit *Start Download*
- **Real-time progress bars** – live percentage, download speed, and ETA streamed to the browser via Socket.IO (no page refresh needed)
- **Multiple simultaneous downloads** – up to 3 concurrent downloads, each with its own progress card
- **Audio notifications** – distinct tones play when a download starts, completes, or fails (Web Audio API, no extra files required)
- **Format selection** – pass any yt-dlp format string (e.g. `best`, `bestvideo+bestaudio`, `mp3`)
- **Cookie support** – supply a cookies.txt path to access age-restricted or login-only content
- **File library** – all downloaded files are listed with name, size, and date; each file can be saved directly from the browser
- **Delete files** – remove downloaded files from the library with a single click
- **Live stats badge** – a persistent badge shows the total storage used
- **Toast notifications** – non-intrusive pop-up messages confirm every action
- **Connection indicator** – live dot shows WebSocket connection status
- **Rate limiting** – max 5 concurrent downloads per IP, max 3 system-wide
- **No playlist downloads** – `--no-playlist` is enforced so single-video URLs are never accidentally expanded

---

## Prerequisites

| Requirement | Version |
|-------------|---------|
| Python | 3.11 + |
| [yt-dlp](https://github.com/yt-dlp/yt-dlp) | latest recommended |
| ffmpeg *(optional)* | for merging video + audio streams |

---

## Installation

```bash
# 1. Clone the repository
git clone https://github.com/AllanRye9/yot_downloader.git
cd yot_downloader

# 2. Create and activate a virtual environment (recommended)
python -m venv venv
source venv/bin/activate   # Windows: venv\Scripts\activate

# 3. Install Python dependencies
pip install -r requirements.txt
```

---

## Usage

```bash
python api/app.py
```

The server starts at **http://127.0.0.1:5000** by default.

1. Open the URL in your browser.
2. Paste a video URL into the *Video URL* field.
3. *(Optional)* Change the **Format** string or provide a **Cookies** file path.
4. Click **Start Download**.
5. Watch the live progress bar and stats (speed / ETA) appear in the *Active Downloads* section.
6. A success tone plays and the file appears in the **Downloaded Videos** list when complete.
7. Click **Save** to download the file to your device, or the trash icon to delete it.

### Format examples

| Format string | Result |
|---------------|--------|
| `best` | Best single-file quality (default) |
| `bestvideo+bestaudio` | Best quality with ffmpeg merge |
| `bestvideo[height<=720]+bestaudio` | Cap at 720p |
| `bestvideo[height<=480]+bestaudio` | Cap at 480p |
| `mp3` | Audio only (requires ffmpeg) |
| `bestaudio` | Best audio stream |

---

## Docker

```bash
docker build -t yot_downloader .
docker run -p 5000:5000 yot_downloader
```

---

## Project Structure

```
yot_downloader/
├── api/
│   └── app.py          # Flask application & download logic
├── templates/
│   └── index.html      # Single-page frontend (HTML + CSS + JS)
├── downloads/          # Created automatically; stores downloaded files
├── requirements.txt    # Python dependencies
├── Dockerfile          # Docker build definition (uses Python 3.12)
└── README.md
```

---

## API Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| `GET` | `/` | Serves the main UI |
| `POST` | `/start_download` | Starts a download; returns `{"download_id": "..."}` |
| `GET` | `/status/<download_id>` | Returns status/progress for a specific download |
| `GET` | `/files` | Lists all files in the downloads folder |
| `GET` | `/active_downloads` | Returns active/queued downloads with progress details |
| `GET` | `/stats` | Returns file count, total size, and active download count |
| `GET` | `/downloads/<filename>` | Streams a downloaded file to the browser |
| `DELETE` | `/delete/<filename>` | Deletes a downloaded file |
| `POST` | `/cancel/<download_id>` | Cancels an ongoing download |
| `GET` | `/health` | Health check endpoint |

### Socket.IO events

| Direction | Event | Payload | Description |
|-----------|-------|---------|-------------|
| Server → Client | `progress` | `{id, line, percent, speed, eta, size}` | yt-dlp progress update |
| Server → Client | `completed` | `{id, filename, title}` | Download finished successfully |
| Server → Client | `failed` | `{id, error}` | Download encountered an error |
| Server → Client | `cancelled` | `{id}` | Download was cancelled |
| Server → Client | `files_updated` | *(none)* | Broadcast when file list changes |
| Client → Server | `subscribe` | `{download_id}` | Join a room to receive progress for a specific download |

---

## Configuration

| Variable | Location | Default | Description |
|----------|----------|---------|-------------|
| `SECRET_KEY` | env / `Config` | random on startup | Flask session secret – set in production |
| `DOWNLOAD_FOLDER` | `Config` | `'downloads'` | Directory where files are saved |
| `ALLOWED_ORIGINS` | env | `"*"` | Restrict in production to your domain |
| `PORT` | env | `5000` | Server port |
| `FLASK_DEBUG` | env | *(unset)* | Enable debug logging |

---

## Tech Stack

- **Backend** – Python, Flask, Flask-SocketIO, eventlet
- **Downloader** – yt-dlp
- **Frontend** – Vanilla HTML/CSS/JavaScript, Socket.IO client
- **Audio** – Web Audio API (no external audio files)
- **Icons** – Font Awesome 6

---

## License

This project is provided as-is for personal and educational use.
